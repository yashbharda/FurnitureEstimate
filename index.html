<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Furniture Estimate Calculator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 <!-- Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d6efd">

<style>
body { background: linear-gradient(135deg, #e3f2fd, #f1f8e9); font-family: "Segoe UI", sans-serif; }
h1 { font-weight: 700; background: -webkit-linear-gradient(#2c3e50, #16a085); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.card { border-radius: 15px; border: none; background: #fff; }
.btn { border-radius: 10px; font-weight: 500; }
.table-responsive {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-radius: 10px;
  background: #fff;
}
.table {
  min-width: 700px; /* ensures scroll on small screens */
}#grandTotal { font-size: 18px; font-weight: bold; color: #16a085; }
</style>
</head>
<body>

<div class="container py-4">
  <h1 class="text-center mb-4">ü™ë Furniture Estimate</h1>
  
  <!-- Customer + Rate -->
  <div class="card shadow p-3 mb-4">
    <div class="mb-2">
      <label for="customerName" class="form-label">Customer Name</label>
      <input type="text" id="customerName" class="form-control" placeholder="Enter customer name" required>
    </div>
    <div class="mb-2">
      <label for="globalRate" class="form-label">Rate (Rs. per sq.ft)</label>
      <input type="number" id="globalRate" class="form-control" placeholder="Enter rate (Rs.)" step="any">
    </div>
  </div>

  <!-- Add Item -->
  <div class="card shadow p-4 mb-4">
    <form id="estimateForm">
      <div class="mb-3">
        <label for="furnitureType" class="form-label">Furniture Name</label>
        <select id="furnitureType" class="form-select" required>
          <option value="">-- Select Furniture --</option>
          <option value="Bed">üõè Bed(‡™™‡™≤‡™Ç‡™ó)</option>
          <option value="Cupboard">üö™ Cupboard(‡™ï‡™¨‡™æ‡™ü)</option>
          <option value="Kitchen">üç¥ Kitchen</option>
          <option value="Temple">üïâ Temple</option>
          <option value="Other">‚ûï Other</option>
        </select>
      </div>

      <div class="mb-3 d-none" id="otherFurnitureDiv">
        <label for="otherFurniture" class="form-label">Enter Furniture Name</label>
        <input type="text" id="otherFurniture" class="form-control" placeholder="Type furniture name">
      </div>

      <div class="mb-3">
        <label for="entryMode" class="form-label">Entry Mode</label>
        <select id="entryMode" class="form-select" required>
          <option value="calc">üìê By Calculation (Height √ó Width √ó Rate)</option>
          <option value="direct">‚úç Direct Amount Entry</option>
          <option value="multiplier">‚úñ Amount √ó Multiplier</option>
        </select>
      </div>

      <!-- Calculation Inputs -->
      <div id="calcInputs">
        <div class="row">
          <div class="col-6 mb-3">
            <label for="height" class="form-label">Height (ft)</label>
            <input type="number" class="form-control" id="height" min="0.1" step="any">
          </div>
          <div class="col-6 mb-3">
            <label for="width" class="form-label">Width (ft)</label>
            <input type="number" class="form-control" id="width" min="0.1" step="any">
          </div>
        </div>
      </div>

      <!-- Direct Amount Input -->
      <div class="mb-3 d-none" id="directInput">
        <label for="directAmount" class="form-label">Enter Amount (Rs.)</label>
        <input type="number" class="form-control" id="directAmount" min="0.1" step="any">
      </div>

      <!-- Multiplier Input -->
      <div class="mb-3 d-none" id="multiplierInput">
        <label for="baseAmount" class="form-label">Enter Amount (Rs.)</label>
        <input type="number" class="form-control" id="baseAmount" min="0.1" step="any">
        <label for="multiplier" class="form-label mt-2">Multiplier</label>
        <input type="number" class="form-control" id="multiplier" min="0.1" step="any" value="1">
      </div>

      <button type="submit" class="btn btn-primary w-100">‚ûï Add Item</button>
    </form>
  </div>

  <!-- Item Table -->
  <div class="mt-4">
  <h3>üìù Estimate Items</h3>
  <div class="table-responsive mt-2">
    <table class="table table-bordered table-striped mb-0">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Furniture</th>
          <th>Dimensions / Mode</th>
          <th>Area (sq.ft)</th>
          <th>Rate</th>
          <th>Amount</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="itemsTable"></tbody>
    </table>
  </div>


    <!-- Totals Section -->
    <div class="mt-3 text-end">
      <h5 id="totalAmount" class="fw-bold text-dark">Total Amount: Rs. 0.00</h5>

      <div class="mt-2">
        <label for="subtractionAmount" class="form-label fw-bold">Subtract / Discount (Rs.):</label>
        <input type="number" id="subtractionAmount" class="form-control d-inline-block w-auto" step="any" value="0">
      </div>

      <h4 id="grandTotal" class="mt-3 text-success fw-bold">Grand Total: Rs. 0.00</h4>
    </div>

    <div class="text-end mt-3">
      <button class="btn btn-success" id="downloadPdf">üìÑ Download PDF</button>
    </div>
  </div>
</div>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
let items = [];

// Show/Hide custom furniture
document.getElementById("furnitureType").addEventListener("change", function(){
  const otherDiv = document.getElementById("otherFurnitureDiv");
  if(this.value==="Other"){ 
    otherDiv.classList.remove("d-none"); 
    document.getElementById("otherFurniture").required = true; 
  } else { 
    otherDiv.classList.add("d-none"); 
    document.getElementById("otherFurniture").required = false; 
  }
});

// Show/Hide inputs based on entry mode
document.getElementById("entryMode").addEventListener("change", function(){
  document.getElementById("calcInputs").classList.add("d-none");
  document.getElementById("directInput").classList.add("d-none");
  document.getElementById("multiplierInput").classList.add("d-none");
  if(this.value==="calc") document.getElementById("calcInputs").classList.remove("d-none");
  else if(this.value==="direct") document.getElementById("directInput").classList.remove("d-none");
  else if(this.value==="multiplier") document.getElementById("multiplierInput").classList.remove("d-none");
});

// Add item
document.getElementById("estimateForm").addEventListener("submit", function(e){
  e.preventDefault();
  let furnitureName = document.getElementById("furnitureType").value;
  if(furnitureName==="Other") furnitureName = document.getElementById("otherFurniture").value;

  const mode = document.getElementById("entryMode").value;
  let rate = 0, height = 0, width = 0, area = 0, total = 0;

  if(mode==="calc"){
    rate = parseFloat(document.getElementById("globalRate").value);
    height = parseFloat(document.getElementById("height").value);
    width = parseFloat(document.getElementById("width").value);
    if(isNaN(rate)||rate<=0){ alert("Enter valid Rate"); return; }
    if(isNaN(height)||height<=0){ alert("Enter valid Height"); return; }
    if(isNaN(width)||width<=0){ alert("Enter valid Width"); return; }
    area = height * width;
    total = area * rate;
  }
  else if(mode==="direct"){
    total = parseFloat(document.getElementById("directAmount").value);
    if(isNaN(total)||total<=0){ alert("Enter valid Amount"); return; }
  }
  else if(mode==="multiplier"){
    let base = parseFloat(document.getElementById("baseAmount").value);
    let mul = parseFloat(document.getElementById("multiplier").value);
    if(isNaN(base)||base<=0){ alert("Enter valid Amount"); return; }
    if(isNaN(mul)||mul<=0) mul = 1;
    total = base * mul;
  }

  items.push({furniture: furnitureName, height, width, area, rate, total, mode});
  renderTable();

  // Reset inputs
  document.getElementById("furnitureType").value = "";
  document.getElementById("otherFurniture").value = "";
  document.getElementById("height").value = "";
  document.getElementById("width").value = "";
  document.getElementById("directAmount").value = "";
  document.getElementById("baseAmount").value = "";
  document.getElementById("multiplier").value = "1";
  document.getElementById("otherFurnitureDiv").classList.add("d-none");
});

// Render table
function renderTable(){
  const table = document.getElementById("itemsTable");
  table.innerHTML = "";
  let totalAmount = 0;

  items.forEach((item, index) => {
    totalAmount += item.total;
    let dimensions = item.mode === "calc" ? `${item.height.toFixed(2)}√ó${item.width.toFixed(2)} ft` : "-";
    let area = item.mode === "calc" ? item.area.toFixed(2) : "-";
    let rate = item.mode === "calc" ? `Rs. ${item.rate.toFixed(2)}` : "-";

    table.innerHTML += `<tr>
      <td>${index+1}</td>
      <td>${item.furniture}</td>
      <td>${dimensions}</td>
      <td>${area}</td>
      <td>${rate}</td>
      <td>Rs. ${item.total.toFixed(2)}</td>
      <td class="text-center"><button class="btn btn-sm btn-danger" onclick="removeItem(${index})">Delete</button></td>
    </tr>`;
  });

  const subtractVal = parseFloat(document.getElementById("subtractionAmount").value) || 0;
  const grandTotal = totalAmount - subtractVal;

  document.getElementById("totalAmount").innerText = `Total Amount: Rs. ${totalAmount.toFixed(2)}`;
  document.getElementById("grandTotal").innerText = `Grand Total: Rs. ${grandTotal.toFixed(2)}`;
}

function removeItem(index){
  items.splice(index,1);
  renderTable();
}

document.getElementById("subtractionAmount").addEventListener("input", renderTable);

// Download PDF
// Download PDF
document.getElementById("downloadPdf").addEventListener("click", function(){
  if(items.length === 0){ 
    alert("Add at least one item"); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFont("helvetica");
  doc.setFontSize(18);
  doc.text("Furniture Estimate", 105, 15, { align: "center" });

  const customerName = document.getElementById("customerName").value || "N/A";
  const today = new Date();
  const dateStr = today.toLocaleDateString();
  doc.setFontSize(12);
  doc.text(`Customer: ${customerName}`, 14, 30);
  doc.text(`Date: ${dateStr}`, 160, 30, { align: "right" });

  const tableColumn = ["#", "Furniture", "Dimensions / Mode", "Foot (sq.ft)", "Rate", "Amount"];
  const tableRows = [];

  items.forEach((item, index) => {
    if (item.total !== 0) {
      const dimensions = item.mode === "calc" ? `${item.height.toFixed(2)}√ó${item.width.toFixed(2)} ft` : "-";
      const area = item.mode === "calc" ? item.area.toFixed(2) : "-";
      const rate = item.mode === "calc" ? `${item.rate.toFixed(2)}` : "-";
      tableRows.push([index+1, item.furniture, dimensions, area, rate, `${item.total.toFixed(2)}`]);
    }
  });

  doc.autoTable({
    startY: 40,
    head: [tableColumn],
    body: tableRows,
    theme: "grid",
    headStyles: { fillColor: [44,62,80], textColor: 255, font: "helvetica" },
    styles: { font: "helvetica", fontSize: 10 }
  });

  const finalY = doc.lastAutoTable.finalY || 40;
  const subtractVal = parseFloat(document.getElementById("subtractionAmount").value) || 0;
  const totalAmount = items.reduce((sum, i) => sum + i.total, 0);
  const grandTotal = totalAmount - subtractVal;

  let yPos = finalY + 12;
  doc.setFont("helvetica", "bold");
  doc.setFontSize(12);

  // Always show Total Amount
  doc.text(`Total Amount: Rs. ${totalAmount.toFixed(2)}`, 160, yPos, { align: "right" });

  // Show subtraction + grand total only if subtraction > 0
  if(subtractVal > 0){
    yPos += 8;
    doc.text(`- Subtraction: Rs. ${subtractVal.toFixed(2)}`, 160, yPos, { align: "right" });
    yPos += 5;
    doc.line(110, yPos, 160, yPos); // underline
    yPos += 8;
    doc.text(`Grand Total: Rs. ${grandTotal.toFixed(2)}`, 160, yPos, { align: "right" });
  }

  doc.save(`${customerName}_${dateStr}.pdf`);
});

</script>

</body>
</html>
